<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Does.Network</title>
  <style>
    /* Set the basic layout */
    body {
      margin: 0;
      font-family: 'Circular', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #FFCF00;
    }
    #text {
      font-size: 3em;
      text-align: center;
      font-family: 'CircularBlack', sans-serif;
      visibility: hidden; /* Hidden by default for mode 1 */
    }
    .mode1 {
      background-color: #FFCF00;
    }
    .mode2 {
      background-color: #4EC23D;
      color: #238413;
    }
    .mode3 {
      background-color: #F83030;
      color: #A61B1B;
    }
  </style>
</head>
<body class="mode1">
  <div id="text"></div>

  <script>
    let mode = 1; // Start with mode 1 (Checking)

    // Function to update the mode and UI
    function updateMode(newMode) {
      const body = document.body;
      const text = document.getElementById('text');

      if (newMode === 1) {
        body.className = 'mode1';
        text.style.visibility = 'hidden'; // No text for mode 1
      } else if (newMode === 2) {
        body.className = 'mode2';
        text.textContent = 'Yes! Your net does work!';
        text.style.visibility = 'visible'; // Show text for mode 2
      } else if (newMode === 3) {
        body.className = 'mode3';
        text.textContent = 'No. Your net does not work.';
        text.style.visibility = 'visible'; // Show text for mode 3
      }
    }

    // Function to check connection to Google
    function checkConnection() {
      fetch('https://www.google.com', { method: 'HEAD', mode: 'no-cors' }) // Sending a simple request to Google
        .then(() => {
          updateMode(2); // If request is successful, switch to mode 2 (Online)
        })
        .catch(() => {
          updateMode(3); // If the request fails, switch to mode 3 (Offline)
          setTimeout(checkConnection, 5000); // Retry every 5 seconds if offline
        });
    }

    // Load fonts explicitly using FontFace API
    const circularBlack = new FontFace('CircularBlack', 'url(circularBlack.ttf)');
    const circular = new FontFace('Circular', 'url(circular.ttf)');

    // Load both fonts and apply them once loaded
    Promise.all([circularBlack.load(), circular.load()])
      .then((loadedFonts) => {
        // Add the loaded fonts to the document
        loadedFonts.forEach((font) => document.fonts.add(font));

        console.log("Fonts are fully loaded and applied.");

        // Now we can begin the connection check process
        updateMode(1); // Set to mode 1 (Checking...)

        setTimeout(() => {
          let timeoutHandle = setTimeout(() => {
            updateMode(3); // If no response within 2 seconds, switch to mode 3 (Offline)
            checkConnection(); // Keep checking every 5 seconds
          }, 2000);

          // Try pinging Google
          fetch('https://www.google.com', { method: 'HEAD', mode: 'no-cors' })
            .then(() => {
              clearTimeout(timeoutHandle); // Stop timeout if we get a response
              updateMode(2); // Switch to mode 2 (Online)
            })
            .catch(() => {
              // Timeout will handle the switch to mode 3 (Offline)
            });
        }, 100); // Start after 0.1 seconds
      })
      .catch((error) => {
        console.error("Error loading fonts:", error);
      });

    // Register the Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, function(err) {
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }
  </script>
</body>
</html>
